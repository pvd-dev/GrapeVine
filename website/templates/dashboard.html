
{% extends "theme.html" %} {% block title %}GrapeVine - Giving Feedback made easy{% endblock %} 


{% block Content%}


<div class="container"></div>
<br><br>
<!--Header of dasbhoard-->
<h1> {{ username }} // Dashboard</h1>

<hr>
<!--Splitting up in grid view for the graphs-->
<div class="row">
  <div class="col-sm-4 ">
    <div class="row">
      <div class="jumbotron jumbotron-fluid rounded bg-light" style="height: 230px">
        <div class="container">
          <br><br>
          <h1 class="display-4">{{ grapevinescore }}</h1>
          <p class="lead">Grapevine Score</p>
          <p>We recalculated your responses into a NPS style score</p>
        </div>
      </div>
    <br>
    
    </div>
    
  </div>
  <div class="col-sm-4 height=100%">
    <div class="row">
      <div class="jumbotron jumbotron-fluid rounded bg-light" style="height: 230px">
        <div class="container">
          <br><br>
          <h1 class="display-4">{{ totalresponses }}</h1>
          <p class="lead">Total responses</p>
          <p>The total of all the feedback you have received</p>
        </div>
      </div>
    <br>
    
    </div>
    
  </div>

  <div class="col-sm-4">
    <div class="row">
      <div class="jumbotron jumbotron-fluid rounded bg-light" style="height: 230px">
        <div class="container">
          <p class="lead">Get your feedback templates now</p>
          <p>Start asking your clients for feedback, by forwarding them one of our templates. We'll send you a ready-to-send copy that you can forward easily. </p>
          <br>
          <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
            <button type="button" class="btn btn-primary text-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEmail" aria-controls="offcanvasEmail"><i class="bi bi-envelope-check"></i> Email</button>
            <button type="button" class="btn btn-primary text-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWhatsapp" aria-controls="offcanvasWhatsapp"> <i class="bi bi-whatsapp"></i> Whatsapp</button>
            <button type="button" class="btn btn-primary text-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasQR" aria-controls="offcanvasQR"><i class="bi bi-qr-code"></i> QR Codes</button>
          </div>
        </div>
      </div>
    <br>
    
    </div>
    
  </div>
  
  <div class="row">
  <div class="col-12">

    <!--Drawing the bar chart-->
    {% if totalresponses  > 0 %}

    <canvas id="lineChart" width="900" height="200"></canvas>
    <script>
      var ctx = document.getElementById("lineChart").getContext("2d");
      var lineChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: {{ labels | safe }},
          datasets: [
            {
            data: {{ values |safe }},
            fill: true,
            backgroundColor: [
              'rgb(180, 231, 218)',
              'rgb(245, 228, 81)',
              'rgb(172, 173, 200)'
            ],
            },
          ]
        },
        options: {
          responsive: true,
          legend: {
            display: false
          }
        }
      });
    </script></div>
    {% else %}


    
    {% endif%}
</div>
</div>
<!-- Drawing the doughnut chart-->
{% if totalresponses  > 0 %}
<div class="row justify-content-between">
  <hr>
  <div class="col-sm-4"><canvas id="pieChart" width="900" height="200"></canvas>
    <script>
      var ctx = document.getElementById("pieChart").getContext("2d");
      var pieChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: {{ percentagelabels | safe }},
          datasets: [
            {
              backgroundColor: [
              'rgb(180, 231, 218)',
              'rgb(245, 228, 81)',
              'rgb(172, 173, 200)'
            ],
            label: " Score",
            data: {{ percentagevalues |safe }},
            fill: false,
            lineTension: 0.5
            },
          ]
        },
        options: {
          responsive: true
        }
      });
    </script></div>
{% else %}
<br><br>
<hr>

<div class="alert alert-warning" role="alert">
  <h4 class="alert-heading">Welcome to GrapeVine!</h4>
  <p>Thank you for trying out Grapevine. We are very pleased to have you on board. From here you are only 2 minutes away of receiving your first pieces of feedback.</p>
  <hr>
  <p class="mb-0">Currently you have not received any feedback, yet. But, as soon as your first customers start interacting with your surveys the results will show up here.</p>
</div>


{% endif%}

  <div class="col-sm-8"><div id="posts"></br >
    {% if totalresponses  > 0 %}
    <h2> What your users are saying:</h2><br>
    {% for post in posts %}
    <div class="card border-grey">
        {% if post.rating > 2 %}
        <div class="card-header d-flex bg-primary justify-content-between align-items-center">
        <h1><i class="far fa-smile" color-primary></i></h1> From customer: {{post.email}}
        {%elif post.rating > 1 %}
        <div class="card-header d-flex bg-secondary justify-content-between align-items-center">
        <h1><i class="far fa-meh" bg-primary></i></h1> From customer: {{post.email}}
        {%elif post.rating < 2 %}
        <div class="card-header d-flex bg-third justify-content-between align-items-center">
        <h1><i class="far fa-frown" bg-primary></i></h1> From customer: {{post.email}}
        {%endif%}
        <div>
          <span id="likes-count-{{post.id}}">
          {{ post.likes|length }}</span> 
          {% if user.id in post.likes|map(attribute="author")|list %}
          <i
            class="fas fa-thumbs-up"
            id="like-button-{{post.id}}"
            onclick="like({{post.id}})"
          ></i>
          {% else %}
          <i
            class="far fa-thumbs-up"
            id="like-button-{{post.id}}"
            onclick="like({{post.id}})"
          ></i>
          {% endif %} {% if user.id == post.author %}
          <div class="btn-group">
            <button
              type="button"
              class="btn btn-sm btn-dark dropdown-toggle"
              data-bs-toggle="dropdown"
              
            ><i class="bi bi-trash"></i></button>
            <ul class="dropdown-menu">
              <li>
                <a href="/delete-post/{{post.id}}" class="dropdown-item"
                  ><i class="bi bi-trash"></i> Delete</a
                >
              </li>
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="card-body">
        <div class="card-text"><h3><b>{{post.text}}</b></h3></div>
        <br />
        <div class="collapse text-dark" id="comments-{{post.id}}">
          <div class="card">
            <div class="card-body" id="comments-expanded-{{post.id}}">
              {% for comment in post.comments %}
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <ul> {{comment.text}}</ul>
                </div>
                <div>
                  <small class="text-muted"> {{comment.date_created}}</small>
                  {% if user.id == comment.author or user.id == post.author %}
                  <div class="btn-group">
                    <button
                      type="button"
                      class="btn btn-sm btn-dark dropdown-toggle"
                      data-bs-toggle="dropdown"
                    ><i class="bi bi-trash"></i></button>
                    <ul class="dropdown-menu">
                      <li>
                        <a
                          href="/delete-comment/{{comment.id}}"
                          class="dropdown-item"
                          ><i class="bi bi-trash"></i> Delete</a
                        >
                      </li>
                    </ul>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        <p class="card-text">
          {% if totalresponses > 0 %}
          <a data-bs-toggle="collapse" href="#comments-{{post.id}}" role="button">
            <small class="text-dark">View {{post.comments|length}} Comments</small>
          </a>
          {% else %}
          <small class="text-muted">No Comments</small>
          {% endif %}
        </p>
        <form
          class="input-group mb-3"
          method="POST"
          action="/create-comment/{{post.id}}"
        >
          <input
            type="text"
            id="text"
            name="text"
            class="form-control"
            placeholder="Add a note"
          />
          <button type="submit" class="btn btn-dark"><i class="bi bi-pen"></i> Add note</button>
        </form>
      </div>
      <div class="card-footer text-muted">{{post.date_created}}</div>
    </div>
  </br > {% endfor %}
  </div> 
  {% else %}
  <!-- If there are 0 posts we show this accordion helping the user getting started-->
  <h2>Get started in 3 simple steps:</h2>
  <div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingOne">
        <button class="accordion-button bg-primary" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
          Step 1: Configure your custom questions
        </button>
      </h2>
      <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
        <div class="accordion-body">
          <p>Custom questions allow you to ask your clients for something specific. It helps you ask them: <br>"How did you like your <strong>Pizza</strong>", <br>Instead of just: "How did you like it" </p>
          <p>Grapevine supports 3 custom questions out of the box, where the first question is the main question. Then youhave the ability to add 2 more follow up questions into the mix to ask them for something specific, like what kind of pizza they ordered. </p>
          <button type="button" class="btn btn-primary text-dark" data-bs-toggle="modal" data-bs-target="#staticBackdrop"> <i class="bi bi-sliders"></i> Set up custom questions</button>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
          Step 2: Share your surveys online, through Whatsapp or Email
        </button>
      </h2>
      <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
        <div class="accordion-body">
          <p>Grapevine allows you to easily connect with your customers. We provide text templates that you can share with your customers. You can send yourself a template on Whatsapp or through email.</p>
          <p>After receiving the template you can easily forward it to a customer you'd like to get some feedback from!</p>

            <button type="button" class="btn btn-primary text-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEmail" aria-controls="offcanvasEmail"><i class="bi bi-envelope-check"></i> Email</button>
            <button type="button" class="btn btn-primary text-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWhatsapp" aria-controls="offcanvasWhatsapp"><i class="bi bi-whatsapp"></i> Whatsapp</button>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingThree">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
          Step 3: Share your QR codes in the real world
        </button>
      </h2>
      <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
        <div class="accordion-body">
          <p>The Grapevine QR codes allow you to ask for feedback in the real world. Your customers can scan the QR codes with their phone and let you know if they liked your service in a matter of seconds </p>
          <p>You can print our read-made template to get started right away, or download your unique QR codes to use in your own designs</p>


          <h5>Scan a QR code to get your first piece of feedback!</h5>
          <div class="card bg-primary" style="width: 500px;">
            <div class="row no-gutters">
                <div class="col-sm-5">
                  <img class="card-img-top bg-secondary" src="{{ url_for('static',filename='qrcodes/User_')}}{{urlPromotorQR}}"  alt="Card image cap">
                </div>
                <div class="col-sm-7">
                    <div class="card-body">
                        <h5 class="card-title">This QR Code generates a bit of positive feedback</h5>
                       
                        
                    </div>
                </div>
            </div>
          </div>

          


          
        </div>
      </div>
    </div>
  </div>
  {% endif %}   
  <!-- end of the getting started accordion-->

</div>
</div>
  
</div>


</div>

<!-- These 2 offcanvas items manage the sliding in of information when users tap the whatsapp and Email buttons-->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasWhatsapp" aria-labelledby="offcanvasWhatsapp">
  
  <div class="offcanvas-header">
    <h3 id="offcanvasWhatsapp">How to get feedback through Whatsapp</h3>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p><i>You can simply receive feedback through whatsapp using our pre-made whatsapp template it works super simple:</i></p>
    <hr>
    <h5>Step 1: Send the template to your phone</h5>
    <p>Grapevine will send you template on your phone, all you have to do is tap this button:</p>
    <a href="/sendwhatsapp/{{user.id}}/{{user.phonenumber}}" class="btn btn-primary text-dark" tabindex="-1" role="button"><i class="bi bi-send-check"></i> Send the Whatsapp template to my phone</a>
    <br>    <br>    <br>
    <img class="app-badge center-block" src="{{ url_for('static',filename='assets/img/chat.png') }}" alt="..." style="max-width: 50%"/>
    <br>
    <br>
    <hr>

    <br>
    <h5>Step 2: Share the template with contacts in your phone </h5>
    <li>Simply hold your finger on the message in Whatsapp, and a menu will pop up. </li>
   <li>Tap "forward" and select the contacts you want to ask for feedback</li>>
    <img class="app-badge center-block" src="{{ url_for('static',filename='assets/img/sharing.jpeg') }}" alt="..." style="max-width: 50%"/>
    <br>
    <br>
    <hr>
    <h5>Or: Copy + paste and make it your own</h5>
    <p>If you want to ask for feedback anywhere else, simply copy paste the template and make it your own!</p>
    <pre><code>
      Hi 

      dhdhdaldi
      data-sb-feedbackdd

      data-device
    </code></pre>
  </div>
</div>
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasEmail" aria-labelledby="offcanvasEmail">
  <div class="offcanvas-header">
    <h3 id="offcanvasWhatsapp">How to get feedback through Email</h3>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p></p><i>You can simply receive feedback through email using our pre-made email template it works super simple:</i></p>
    <hr>
    <h5>Method 1: Send the template to your mailbox</h5>
    <p>Grapevine will send your template to your mailbox on the email address you used during signup, all you have to do is tap this button:</p>
    <a href="/sendemail/{{user.id}}/{{user.email}}" class="btn btn-primary text-dark" tabindex="-1" role="button"> <i class="bi bi-send-check"></i> Send the template to <b>my</b> email address</a>
    <br>
    <br>
    <hr>
    <br>
    <h5>Method 2: Send the feedback template to your contacts directly</h5>
    <p>Grapevine can also send the email template to one of your contacts directly. Simply add the email address of your recipients and hit send.</p>
    <div class="input-group mb-3">
      <input type="text" class="form-control" placeholder="Email address of your recipient" aria-label="Recipient's username" aria-describedby="button-addon2">
      <button class="btn btn-primary text-dark" type="button" id="button-addon2">Send to client</button>
    </div>
    <small>Did you know you can add multiple recipients by separating email addresses using commas?</small>
    <br>
    <br>
    <hr>
    <br>
    <h5>Method 3: Copy + paste and make it your own</h5>
    <p>If you want to ask for feedback anywhere else, simply copy paste the template and make it your own!</p>
    <pre><code>
      Hi 

      dhdhdaldi
      data-sb-feedbackdd

      data-device
    </code></pre>
  </div>
</div>



<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasQR" aria-labelledby="offcanvasQR">
  <div class="offcanvas-header">
    <h3 id="offcanvasWhatsapp">How to get feedback through QRcode</h3>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p></p><i>You can simply receive feedback by having your customers scan our custom QR Codes. The QR codes will take your users to our chat to answer some followup questions:</i></p>
    <p>How it works:
      <ul>1. Your customers scan the QR code that fits with how they liked your service (Happy, neutral, unhappy)</ul>
      <ul>2. Your customer ends in our custom built chat to answer some follow up questions</ul>
      <ul>3. The responses end up in your dashboard</ul>
    </p>
    <hr>
    <h5>Step 1: Download our custom QR codes</h5>
    <p>Grapevine allows for super simple feedback collection through QR codes. There are 3 QR separate QR codes and feedback is given by scanning a specific one.
      <ul><b>Promotor</b> - If the user scans this QR code you'll receive positive feedback</ul>
      <ul><b>Neutral</b> - If the user scans this QR code you'll receive neutral feedback</ul>
      <ul><b>Detractor</b> - If the user scans this QR code you'll receive negative feedback</ul>

    </p>
    <div class="btn-group" role="group">
      <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle text-dark" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-download"></i> Download QR Codes
      </button>
      <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
        <li><a class="dropdown-item text-dark " href="/downloadQR/{{user.id}}/promotor">Happy Feedback QR code</a></li>
        <li><a class="dropdown-item text-dark " href="/downloadQR/{{user.id}}/neutral">Neutral Feedback QR code</a></li>
        <li><a class="dropdown-item text-dark " href="/downloadQR/{{user.id}}/detractor">Unhappy Feedback QR code</a></li>
      
      </ul>
      <br>
    </div>
    <br>
    <br>
    <hr>
    <br>
    <h5>Step 2: Add the QR codes to a design of your own</h5>
    <p>Whether you're adding them on a t-shirt, coaster or make stickers to add to your foodtruck, Grapevine has got you covered. These High resolution QR codes work everywhere you put them.</p>
    <img class="app-badge center-block" src="{{ url_for('static',filename='assets/img/foodtruck.jpg') }}" alt="..." style="max-width: 100%"/>
      <br>
    <hr>
    <div class="card bg-primary" style="max-width: 100%">
      <div class="row no-gutters">
          <div class="col-sm-3">
            <img class="card-img-top bg-secondary" src="{{ url_for('static',filename='qrcodes/User_')}}{{urlPromotorQR}}" style="max-width: 100%" alt="Card image cap">
          </div>
          <div class="col-sm-7">
              <div class="card-body">
                  <h5 class="card-title">This QR Code generates a bit of positive feedback</h5>
                 
                  
              </div>
          </div>
      </div>
    </div>

    <div class="card bg-secondary" style="max-width: 100%">
      <div class="row no-gutters">
          <div class="col-sm-3">
            <img class="card-img-top bg-secondary" src="{{ url_for('static',filename='qrcodes/User_')}}{{urlNeutralQR}}" style="max-width: 100%" alt="Card image cap">
          </div>
          <div class="col-sm-7">
              <div class="card-body">
                  <h5 class="card-title">This QR Code generates a bit of neutral feedback</h5>
                 
                  
              </div>
          </div>
      </div>
    </div>

    <div class="card bg-third" style="max-width: 100%">
      <div class="row no-gutters">
          <div class="col-sm-3">
            <img class="card-img-top bg-secondary" src="{{ url_for('static',filename='qrcodes/User_')}}{{urlDetractorQR}}" style="max-width: 100%" alt="Card image cap">
          </div>
          <div class="col-sm-7">
              <div class="card-body">
                  <h5 class="card-title">This QR Code generates a bit of negative feedback</h5>
                 
              </div>    
              </div>
          </div>
      </div>
      <hr>
    <br>
    <h5>Method 2: Or use our custom template with your QR codes</h5>
    <p>If you want to ask for feedback right now without having to design anything, then just print the standard Grapevine Template and you're on your way!</p>
    <img class="app-badge center-block" src="{{ url_for('static',filename='assets/img/mockup.jpeg') }}" alt="..." style="max-width: 100%"/>
    <br><br>
    <button  type="button" class="btn btn-primary text-dark"><i class="bi bi-download"></i> Download our QR template </button>
  </div>
</div>
<!-- Here end the 2 offcanvas items -->

<!-- Modal for Settings -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Account Settings</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
                  <form>
                    <h6>Your details:</h6>
                    <div class="mb-3 row">
                      <label for="staticEmail" class="col-sm-2 col-form-label">Username</label>
                      <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="{{user.username}}">
                        
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <label for="staticEmail" class="col-sm-2 col-form-label">User ID </label>
                      <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="{{user.id}}">
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <label for="staticEmail" class="col-sm-2 col-form-label">Email</label>
                      <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="{{user.email}}">
                      </div>
                    </div>
                    <div class="mb-3 row">
                      <label for="staticEmail" class="col-sm-2 col-form-label">Phone</label>
                      <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="{{user.phonenumber}}">
                      </div>
                    </div>
                    <button type="button" class="btn btn-primary text-dark"><i class="bi bi-pencil-square"></i> Edit</button>

                    <hr>
                    <h6>Custom questions:</h6>
                    <p>Custom questions allow you to ask your customers specific things, and to add followup questions. You can add up to 3 custom questions. </p>


                    
                    <div class="mb-3">
                      <label for="exampleInputEmail1" class="form-label">First question: Ask your customers to rate you</label>
                      <input type="text" class="form-control" id="FirstCustomQuestion" placeholder="{{user.customquestion0}}" aria-describedby="emailHelp">
                      
                      <div id="emailHelp" class="form-text">This question is used in the whatsapp and email template to invoke a response from your customer </div>
                    </div>
                    <div class="mb-3">
                      <label for="exampleInputPassword1" class="form-label">Followup Question 1</label>
                      <input type="text" class="form-control" placeholder="{{user.customquestion1}}" id="FollowUpQuestion1">
                      <div id="emailHelp" class="form-text">If users enter the chat, this will be a followup question they will see</div>
                    </div>
                    <div class="mb-3">
                      <label for="exampleInputPassword1" class="form-label">Followup Question 2</label>
                      <input type="text" class="form-control" placeholder="{{user.customquestion2}}"  id="FollowUpQuestion2">
                      <div id="emailHelp" class="form-text">If users enter the chat, this will be a followup question they will see </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary text-dark"><i class="bi bi-check2-square"></i> Save Custom Questions</button>
                  </form>
                  <hr>
                  <h6>Download & Reset</h6>
                  <p>
                    If you want to start over you can download the feedback you have received so far in a CSV file for your archive and then delete all the responses you have received. 
                   Be aware that you can't restore deleted responses</p>
                  <button type="button" class="btn btn-primary text-dark"><i class="bi bi-file-earmark-spreadsheet"></i> Download CSV</button>

                  <button type="button" class="btn btn-danger"><i class="bi bi-trash"></i> Reset account</button>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary text-dark" data-bs-dismiss="modal"><i class="bi bi-back"></i> Back</button>
        
      </div>
    </div>
  </div>
</div>



{% endblock%}
        